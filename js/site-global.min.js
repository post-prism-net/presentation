debugmode=!0,debuglog=function(log){debugmode&&"undefined"!=typeof console&&console.log(log)},requestAnimationFramePolyfill=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)},config=new Array;var site=function(){var isJumping,isScrolling,init=function(){debuglog("site.init()"),bindEventHandlers(),sections.init(),path.init(),nav.init(),win.init(),content.init(),browser.init()},bindEventHandlers=function(){$(document).on("keydown",function(e){(37==e.keyCode||38==e.keyCode)&&(debuglog("prev"),e.preventDefault(),sections.getPrev()&&!isJumping&&(debuglog("prev: "+sections.getPrev()),location.hash="/"+sections.getPrev()+"/")),(39==e.keyCode||40==e.keyCode)&&(debuglog("next"),e.preventDefault(),sections.getNext()&&!isJumping&&(debuglog("next: "+sections.getNext()),location.hash="/"+sections.getNext()+"/"))}),$(document).on("click","video",function(){var el=$(this);el.toggleClass("full")}),setTimeout(function(){$("slide").first().focus()},1500)},win=function(){var winEl,winScrollTop,winHeight,resizeDelay,scrollSpeed=1.5,init=function(){debuglog("site.win.init()"),winEl=$(window),winHeight=winEl.height(),isJumping=!1,isScrolling=!1,bindEventHandlers(),scrollLoop()},bindEventHandlers=function(){winEl.on("resize",function(){resizeDelay&&clearTimeout(resizeDelay),resizeDelay=setTimeout(resize,1e3)})},scrollLoop=function(){var _winScrollTop=winScrollTop;winScrollTop=winEl.scrollTop(),winScrollTop!=_winScrollTop?(isScrolling=!0,scroll()):isScrolling=!1,requestAnimationFramePolyfill(scrollLoop)},scroll=function(){debuglog("site.win.scroll()"),sections.check(winScrollTop,winHeight)},scrollTo=function(el,offset){if(debuglog("site.win.scrollTo( "+el+", "+offset+" )"),el.length>0&&!isScrolling){var offset=offset||0,position=el.position().top-offset,distance=Math.floor(Math.abs(position-winScrollTop)),duration=Math.floor(distance/scrollSpeed);duration=500,debuglog("position: "+position),debuglog("duration: "+duration),isJumping=!0,$("html,body").animate({scrollTop:position},duration,"easeInOutQuart",function(){isJumping=!1})}},resize=function(){sections.init(),init()};return{init:function(){init()},scrollTo:function(el,offset){scrollTo(el,offset)},resize:function(){resize()}}}(),sections=function(){var currentSlide,_currentSlide,cache=new Array,init=function(){debuglog("site.sections.init()"),bindEventHandlers(),createCache()},bindEventHandlers=function(){$(document).on("click","slide",function(){var val=$(this).attr("data-step");if(val){var val=parseInt(val);val++,$(this).attr("data-step",val)}})},createCache=function(){var i=0;$("section").each(function(){var section=new Array;section.slug=$(this).attr("data-section"),section.title=$(this).attr("data-title"),section.offset=Math.floor($(this).position().top);var slides=new Array;$(this).find("slide").each(function(){var slide=new Array,slug="slide-"+i;$(this).attr("data-slide",slug),slide.slug=slug,slide.offset=Math.floor($(this).position().top),i++,slides.push(slide)}),section.slides=slides,cache.push(section)}),debuglog(cache)},check=function(scrollTop,winHeight){for(var i=0;i<cache.length;i++)for(var j=0;j<cache[i].slides.length;j++)scrollTop>cache[i].slides[j].offset-2*winHeight/3&&(currentSlide=cache[i].slides[j].slug);currentSlide!=_currentSlide&&change(currentSlide),_currentSlide=currentSlide},change=function(slug){debuglog("site.sections.change( "+slug+" )");var currentSection=$('[data-slide="'+slug+'"]').closest("section").attr("data-section");nav.mark(currentSection),mark(slug),_currentSlide&&!isJumping&&path.set(slug)},mark=function(slug){debuglog("site.sections.mark( "+slug+" )"),$("slide").removeClass("current"),$('slide[data-slide="'+slug+'"]').addClass("current"),$("body").attr("data-slide",slug)},getNext=function(){var index=new Array;for(i=0;i<cache.length;i++)for(j=0;j<cache[i].slides.length;j++)cache[i].slides[j].slug==currentSlide&&(index.section=i,index.slide=j);if(index.slide>cache[index.section].slides.length-2&&(index.section=index.section+1,index.slide=-1),debuglog(index),index.section<cache.length){var next=cache[index.section].slides[index.slide+1].slug;return next}return!1},getPrev=function(){var index=new Array;for(i=0;i<cache.length;i++)for(j=0;j<cache[i].slides.length;j++)cache[i].slides[j].slug==currentSlide&&(index.section=i,index.slide=j);if(0==index.slide&&(index.section=index.section-1,index.slide=cache[index.section].slides.length),debuglog(index),index.section>-1){var prev=cache[index.section].slides[index.slide-1].slug;return prev}return!1},getSections=function(){return debuglog("site.sections.getSections()"),cache};return{init:function(){init()},getSections:function(){return getSections()},getNext:function(){return getNext()},getPrev:function(){return getPrev()},check:function(scrollTop,winHeight){return check(scrollTop,winHeight)}}}(),nav=function(){var navEl,_current,init=function(){debuglog("site.nav.init()"),navEl=build(),_current=void 0,bindEventHandlers()},bindEventHandlers=function(){},build=function(){debuglog("site.nav.build()"),$("nav").length>0&&$("nav").remove();for(var html=$("<nav><h1>post-prism.net</h1><span><ul></ul></span></nav>"),ul=html.find("ul"),s=sections.getSections(),i=0;i<s.length;i++)item=$('<li><a href="#/'+s[i].slug+'/">'+s[i].title+"</a></li>"),ul.append(item);return html.prependTo($("body")),html},mark=function(slug){if(debuglog("site.nav.mark( "+slug+" )"),slug!=_current){var liHeight=navEl.find("li").first().height();navEl.find("a").not('[href$="#/'+slug+'/"]').closest("li").removeClass("current"),navEl.find('[href$="#/'+slug+'/"]').closest("li").addClass("current");var index=navEl.find("li").index(navEl.find(".current"))+1,marginTop=parseInt(liHeight)*(index-1)*-1;navEl.find("li").first().css({marginTop:marginTop+"px"}),_current=slug}};return{init:function(){init()},mark:function(slug){mark(slug)}}}(),path=function(){var linksEl,init=function(){linksEl=$('[href^="#"]'),saveLinks(),rewriteLinks(),bindEventHandlers(),checkPath($.address.value())},bindEventHandlers=function(){$.address.externalChange(function(){checkPath($.address.value())})},saveLinks=function(){debuglog("site.path.saveLinks()"),linksEl.not("[data-url]").each(function(){$(this).attr("data-url",$(this).attr("href"))})},rewriteLinks=function(){debuglog("site.path.rewriteLinks()"),linksEl.each(function(){var link=$(this),url=link.attr("href").replace("#","");url="#/"+url,link.attr("href",url)})},set=function(path){debuglog("site.path.set( "+path+" )"),$.address.path(path)},checkPath=function(path){debuglog("path.checkPath("+path+")");var path=path||"";if(path=path.split("/"),slide=path[1]||"home"){var target=$('[data-slide="'+slide+'"]');win.scrollTo(target)}};return{init:function(){init()},set:function(path){set(path)}}}(),content=function(){var init=function(){debuglog("site.content.init()"),bindEventHandlers(),layoutBlockquotes()},bindEventHandlers=function(){},layoutBlockquotes=function(){$("blockquote").each(function(){var marginLeft=Math.floor(30*Math.random());$(this).css({marginLeft:marginLeft+"%"})})};return{init:function(){init()}}}(),browser=function(){var init=function(){debuglog("site.browser.init()"),bindEventHandlers()},bindEventHandlers=function(){window.setInterval(function(){var el=$(".browser > iframe").first(),contentWnd=el.get(0).contentWindow,url=contentWnd.window.location;debuglog(url),url="http://post-prism.net/h0110w/"+url.hash,el.siblings("address").text(url)},1e3),$(document).on("click",".browser > a",function(e){e.preventDefault(),$(this).closest(".browser").toggleClass("fixed")})};return{init:function(){init()}}}();return{init:function(){init()}}}();$(document).ready(function(){config.blogurl=location.protocol+"//"+location.hostname+location.pathname,config.breakpoint=$("title").css("width"),config.mediaquery=$("title").css("fontFamily").replace(/'/g,"").replace(/"/g,""),debuglog("site-global.js loaded..."),debuglog(config.blogurl),debuglog(config.mediaquery),site.init(),$("html").removeClass("no-js")});